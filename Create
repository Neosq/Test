-- create.lua
-- Script generator tab (Movement scripts + Firing + ESP Parts)

return function(Win, hub)
    local CT = Win:Tab({
        Title = "Create",
        Icon = "code",
        Visible = true
    })

    CT:Paragraph({
        Title = "Script Generator",
        Desc = "Create custom scripts for teleportation and firing"
    })

    CT:Divider()

    local CM = CT:MultiSection({
        Title = "Scripts",
        Sections = {"Movement", "Firing", "ESP Parts"}
    })

    -- Movement scripts
    CM.Movement:Button({
        Title = "Create Tp Script",
        Icon = "zap",
        Callback = function()
            local char = hub.LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local pos = char.HumanoidRootPart.Position
                local code = string.format(
                    'game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(%.2f, %.2f, %.2f)',
                    pos.X, pos.Y, pos.Z
                )
                setclipboard(code)
                hub:Notify("Success", "Teleport script copied!", "clipboard-check")
            else
                hub:Notify("Error", "Character or root part not found", "x")
            end
        end
    })

    local tweenSpeed = 2

    CM.Movement:Slider({
        Title = "Tween Speed",
        Value = {Min = 0.5, Max = 10, Default = 2},
        Step = 0.5,
        Flag = "TweenSpeed",
        Callback = function(v) tweenSpeed = v end
    })

    CM.Movement:Button({
        Title = "Create Tween Script",
        Icon = "move",
        Callback = function()
            local char = hub.LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local pos = char.HumanoidRootPart.Position
                local code = string.format([[
local TweenService = game:GetService("TweenService")
local player = game.Players.LocalPlayer
local char = player.Character
local hrp = char and char:FindFirstChild("HumanoidRootPart")

if hrp then
    local tweenInfo = TweenInfo.new(%.1f, Enum.EasingStyle.Linear)
    local goal = {CFrame = CFrame.new(%.2f, %.2f, %.2f)}
    TweenService:Create(hrp, tweenInfo, goal):Play()
end
]], tweenSpeed, pos.X, pos.Y, pos.Z)

                setclipboard(code)
                hub:Notify("Success", "Tween script copied!", "clipboard-check")
            else
                hub:Notify("Error", "Character or root part not found", "x")
            end
        end
    })

    -- Firing section with dropdowns
    CM.Firing:Divider()

    local globalFireType = "ProximityPrompt"

    CM.Firing:Dropdown({
        Title = "Fire Type (Global)",
        Values = {"ProximityPrompt", "ClickDetector", "TouchInterest"},
        Multi = false,
        Value = "ProximityPrompt",
        Flag = "GlobalFireType",
        Callback = function(v)
            globalFireType = v
        end
    })

    CM.Firing:Button({
        Title = "Fire Selected Type (Global)",
        Icon = "radio",
        Callback = function()
            local code = ""

            if globalFireType == "ProximityPrompt" then
                code = [[for _,v in pairs(workspace:GetDescendants()) do if v:IsA("ProximityPrompt") then fireproximityprompt(v) end end]]
            elseif globalFireType == "ClickDetector" then
                code = [[for _,v in pairs(workspace:GetDescendants()) do if v:IsA("ClickDetector") then fireclickdetector(v) end end]]
            elseif globalFireType == "TouchInterest" then
                code = [[local c = game.Players.LocalPlayer.Character if c and c:FindFirstChild("HumanoidRootPart") then for _,v in pairs(workspace:GetDescendants()) do if v:IsA("BasePart") and v:FindFirstChild("TouchInterest") then firetouchinterest(c.HumanoidRootPart, v, 0) firetouchinterest(c.HumanoidRootPart, v, 1) end end end]]
            end

            if code ~= "" then
                setclipboard(code)
                hub:Notify("Success", globalFireType .. " fire script copied (global)", "clipboard-check")
            end
        end
    })

    CM.Firing:Divider()

local partNamesInput = ""           
local selectedOptions = {}          
local tweenSpeedAuto = 16           

CM.Firing:Input({
    Title = "Part Names / Paths (comma separated)",
    Value = "",
    Placeholder = "Part1, Part2, Part3",
    Flag = "PartNamesInput",
    Callback = function(v)
        partNamesInput = v
    end
})

CM.Firing:Dropdown({
    Title = "Fire Options (multi-select)",
    Values = {
        "Allow Teleport",
        "Allow Tween",
        "Multi Part (ignore numbering)",
        "Allow Path (full path support)"
    },
    Multi = true,
    Value = {"Allow Teleport"},  
    Callback = function(selected)
        selectedOptions = selected
        
        if table.find(selected, "Allow Teleport") and table.find(selected, "Allow Tween") then
            local newSelected = {}
            for _, opt in ipairs(selected) do
                if opt ~= "Allow Teleport" then table.insert(newSelected, opt) end
            end
            selectedOptions = newSelected
            hub:Notify("Conflict", "Tween & Teleport can't be enable at the same time.", "alert-triangle", 4)
        end
        
    end
})

task.spawn(function()
    while task.wait(1) do
        local char = hub.LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            tweenSpeedAuto = char.Humanoid.WalkSpeed
        end
    end
end)

CM.Firing:Button({
    Title = "Fire Selected Types (In Part)",
    Icon = "target",
    Callback = function()
        if partNamesInput == "" then
            hub:Notify("Error", "Введите хотя бы одно имя/путь", "x")
            return
        end

        local names = {}
        for name in string.gmatch(partNamesInput, "[^,]+") do
            table.insert(names, name:match("^%s*(.-)%s*$"))  -- убираем пробелы
        end

        local hasTeleport = table.find(selectedOptions, "Allow Teleport")
        local hasTween    = table.find(selectedOptions, "Allow Tween")
        local multiPart   = table.find(selectedOptions, "Multi Part (ignore numbering)")
        local allowPath   = table.find(selectedOptions, "Allow Path (full path support)")

        local tpCode = ""
        if hasTeleport then
            tpCode = [[
    local c = game.Players.LocalPlayer.Character
    if c and c:FindFirstChild("HumanoidRootPart") then
        c.HumanoidRootPart.CFrame = p.CFrame + Vector3.new(0, 3, 0)
        wait(0.1)
    end
]]
        end

        local tweenCode = ""
        if hasTween then
            tweenCode = string.format([[
    local TweenService = game:GetService("TweenService")
    local c = game.Players.LocalPlayer.Character
    if c and c:FindFirstChild("HumanoidRootPart") then
        local hrp = c.HumanoidRootPart
        local tweenInfo = TweenInfo.new(%d, Enum.EasingStyle.Linear)
        local goal = {CFrame = p.CFrame + Vector3.new(0, 3, 0)}
        TweenService:Create(hrp, tweenInfo, goal):Play()
        wait(%d + 0.2)
    end
]], tweenSpeedAuto, tweenSpeedAuto)
        end

        local fireCodes = {}
        for _, typeName in ipairs({"ProximityPrompt", "ClickDetector", "TouchInterest"}) do
            local loop = ""
            if typeName == "ProximityPrompt" then
                loop = [[for _,v in pairs(p:GetDescendants()) do if v:IsA("ProximityPrompt") then fireproximityprompt(v) end end]]
            elseif typeName == "ClickDetector" then
                loop = [[for _,v in pairs(p:GetDescendants()) do if v:IsA("ClickDetector") then fireclickdetector(v) end end]]
            elseif typeName == "TouchInterest" then
                loop = [[
    local c = game.Players.LocalPlayer.Character
    if c and c:FindFirstChild("HumanoidRootPart") then
        for _,v in pairs(p:GetDescendants()) do
            if v:IsA("BasePart") and v:FindFirstChild("TouchInterest") then
                firetouchinterest(c.HumanoidRootPart, v, 0)
                firetouchinterest(c.HumanoidRootPart, v, 1)
            end
        end
    end]]
            end
            table.insert(fireCodes, loop)
        end

        local finalScript = ""
        for _, name in ipairs(names) do
            local findCode = allowPath and ('local p = ' .. name) or ('local p = workspace:FindFirstChild("' .. name .. '", true)')
            if multiPart then
                findCode = 'for _, p in pairs(workspace:GetDescendants()) do if p.Name == "' .. name .. '" then'
            end

            local scriptPart = findCode .. [[
    if p then
]] .. tpCode .. tweenCode

            for _, f in ipairs(fireCodes) do
                scriptPart = scriptPart .. "\n        " .. f
            end

            scriptPart = scriptPart .. "\n    end\n"

            if multiPart then scriptPart = scriptPart .. "end" end

            finalScript = finalScript .. scriptPart .. "\n"
        end

        setclipboard(finalScript)
        hub:Notify("Success", "Script " .. #names .. " Copied", "clipboard-check")
    end
})

CM["ESP Parts"]:Input({
    Title = "Part/Model Names",
    Value = "",
    Placeholder = "Part1, Part2, Part3",
    Flag = "ESPPartNames",
    Callback = function(v)
        espPartName = v
    end
})

    CM.Firing:Input({
        Title = "Part Name (In Part Fire)",
        Value = "",
        Placeholder = "Enter part name",
        Flag = "PartName",
        Callback = function(v) partName = v end
    })

    CM.Firing:Toggle({
        Title = "Teleport to Part Before Fire",
        Value = false,
        Flag = "AllowTeleport",
        Callback = function(v) allowTeleport = v end
    })

    CM.Firing:Dropdown({
        Title = "Fire Type (In Part)",
        Values = {"ProximityPrompt", "ClickDetector", "TouchInterest"},
        Multi = false,
        Value = "ProximityPrompt",
        Flag = "PartFireType",
        Callback = function(v)
            partFireType = v
        end
    })
    CM["ESP Parts"]:Toggle({
        Title = "Enable ESP",
        Value = false,
        Flag = "ESPPartEnabled",
        Callback = function(v)
            espPartEnabled = v
            if v then
    local names = {}
    for name in string.gmatch(espPartName, "[^,]+") do
        table.insert(names, name:match("^%s*(.-)%s*$"))
    end

    espPartHighlights = {}
    for _, obj in pairs(workspace:GetDescendants()) do
        if (obj:IsA("BasePart") or obj:IsA("Model")) then
            for _, n in ipairs(names) do
                if obj.Name == n then
                    local h = Instance.new("Highlight")
                    h.Adornee = obj
                    h.FillColor = espPartColor
                    h.OutlineColor = espPartColor
                    h.FillTransparency = 0.5
                    h.OutlineTransparency = 0
                    h.Parent = obj
                    table.insert(espPartHighlights, h)
                end
            end
        end
    end

                hub:Notify("Success", "ESP enabled for: " .. espPartName .. " (" .. #espPartHighlights .. " objects)", "check")
            else
                for _, hl in pairs(espPartHighlights) do
                    pcall(function() hl:Destroy() end)
                end
                espPartHighlights = {}
                hub:Notify("Info", "ESP for parts disabled", "info")
            end
        end
    })

    CM["ESP Parts"]:Button({
        Title = "Delete ESP for this Part",
        Icon = "trash",
        Callback = function()
            if espPartName == "" then
                hub:Notify("Error", "Enter part name first", "x")
                return
            end

            local count = 0
            for i = #espPartHighlights, 1, -1 do
                local hl = espPartHighlights[i]
                if hl and hl.Adornee and hl.Adornee.Name == espPartName then
                    pcall(function() hl:Destroy() end)
                    table.remove(espPartHighlights, i)
                    count += 1
                end
            end

            hub:Notify("Success", "Removed ESP for " .. espPartName .. " (" .. count .. " objects)", "check")
        end
    })

    CM["ESP Parts"]:Button({
        Title = "Delete All Part ESP",
        Icon = "trash-2",
        Callback = function()
            for _, hl in pairs(espPartHighlights) do
                pcall(function() hl:Destroy() end)
            end
            espPartHighlights = {}
            espPartEnabled = false
            hub:Notify("Success", "All part ESP removed", "check")
        end
    })
end
